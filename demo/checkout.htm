<!DOCTYPE html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<head>

</head>

<body>

    <script src="../dist/paypal.checkout.v4.js"></script>

    <style>
        body {
            background-color: white;
        }
    </style>

    <h1>Checkout!</h1>

    <button onclick="window.authorize()">Authorize Payment</button><br />

    <button onclick="window.ppclose()">Close</button>

    <script>
        (function() {

            var parent = (window.opener || window.parent);
            var parentUrl = parent.location.protocol + '//' + parent.location.host + parent.location.pathname;

            var ecToken;

            var checkout = ppxo.PayPalCheckout.attach({

                onEnter: function() {

                    this.props.paymentToken().then(function(token) {
                        ecToken = token;
                        console.log('got paypal token!', ecToken);

                        this.props.init({
                            cancelUrl: parentUrl + '?token=' + ecToken + '&ts=' + Date.now()
                        });
                    });
                },

                defaultProps: {

                    paymentToken: function() {
                        console.log('getting token from url', window.location.href);
                        return window.location.href.match(/token=((EC-)?[A-Z0-9]{17})/)[1];
                    }
                }
            });

            window.authorize = function authorize() {
                if (checkout.props.onPaymentAuthorize) {
                    checkout.props.onPaymentAuthorize({
                        paymentToken: ecToken,
                        payerID: 'SD8778VSD7VD6SV',
                        returnUrl: parentUrl + '?token=' + ecToken + '&payerId=SD8778VSD7VD6SV&ts=' + Date.now()
                    });
                }
            }

            window.ppclose = function() {
                checkout.close();
            }

        })();
    </script>

</body>
